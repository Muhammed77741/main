# –ê–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ –ª–æ–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìã –õ–æ–≥–∏ –ø—Ä–æ–±–ª–µ–º—ã

```
[20:00:06] ‚úÖ SIGNAL FOUND!
[20:00:06] SL: $5026.17 | TP1/2/3: $5156.17/$5186.17/$5216.67
[20:00:06] üìà OPENING 3-POSITION BUY GROUP
[20:00:06] Position 1 (TP1): 0.03 lot
[20:00:06] Position 2 (TP2): 0.03 lot
[20:00:06] Position 3 (TP3): 0.03 lot
[20:00:06] ‚úÖ TP1 position opened!
[20:00:07] ‚úÖ TP2 position opened!
[20:00:07] ‚úÖ TP3 position opened!
[20:00:08] ‚úÖ Successfully opened 3/3 positions!
[20:00:08] ‚úÖ Position group saved to database: e0d3e8e3
[20:00:18] ‚úÖ Restored position group e0d3e8e3 from database
[20:00:18] TP1 hit: False, Max: 5096.17, Min: 5096.17
[20:00:18] üéØ Group e0d3e8e3 Position 1 closed! Activating trailing for Pos 2 & 3  ‚¨ÖÔ∏è –ë–ê–ì!
[20:00:18] ‚úÖ Saved TP1 hit to database for group e0d3e8e3
[20:00:18] ‚ö†Ô∏è  SL too close to price ($5095.21), skipping update  ‚¨ÖÔ∏è –ó–∞—â–∏—Ç–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞!
[20:00:18] ‚ùå Failed to update SL on MT5: No result
[20:00:18] ‚ö†Ô∏è  SL not updated in memory - broker update failed
[20:00:18] ‚úÖ Updated 1 trade(s): order_id=239809, status=CLOSED
[20:00:18] ‚úÖ Updated 1 trade(s): order_id=239808, status=CLOSED
[20:00:18] ‚úÖ Updated 1 trade(s): order_id=239807, status=CLOSED
[20:01:35] ‚ö†Ô∏è  No trades found in CSV either
```

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

1. **20:00:06-20:00:08**: –û—Ç–∫—Ä—ã–ª–∏—Å—å 3 –ø–æ–∑–∏—Ü–∏–∏
   - Entry: ~$5096.17
   - SL: $5026.17 (–Ω–∞ 70 –ø—É–Ω–∫—Ç–æ–≤ –Ω–∏–∂–µ)
   - TP1: $5156.17 (–Ω–∞ 60 –ø—É–Ω–∫—Ç–æ–≤ –≤—ã—à–µ)
   - TP2: $5186.17 (–Ω–∞ 90 –ø—É–Ω–∫—Ç–æ–≤ –≤—ã—à–µ)
   - TP3: $5216.67 (–Ω–∞ 120 –ø—É–Ω–∫—Ç–æ–≤ –≤—ã—à–µ)

2. **20:00:18** (—á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥!): –ü–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã–ª–∞—Å—å
   - –¶–µ–Ω–∞: $5095.21 (–ù–ò–ñ–ï –≤—Ö–æ–¥–∞!)
   - TP1 = $5156.17 –ù–ï –î–û–°–¢–ò–ì–ù–£–¢
   - –ó–Ω–∞—á–∏—Ç, –ø–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã–ª–∞—Å—å **–ü–û STOP LOSS** ($5026.17)

3. **20:00:18**: –ë–æ—Ç –æ—à–∏–±–æ—á–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª —Ç—Ä–µ–π–ª–∏–Ω–≥
   - "Position 1 closed! Activating trailing" ‚¨ÖÔ∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì**
   - –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –ù–ï –ø—Ä–æ–≤–µ—Ä—è–ª–∞, –ü–û –ö–ê–ö–û–ô –ø—Ä–∏—á–∏–Ω–µ –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø–æ–∑–∏—Ü–∏—è 1

4. **20:00:18**: –ü–æ–ø—ã—Ç–∫–∞ –æ–±–Ω–æ–≤–∏—Ç—å SL –ø–æ–∑–∏—Ü–∏–π 2 –∏ 3
   - "SL too close to price" ‚¨ÖÔ∏è –ú–æ—è –∑–∞—â–∏—Ç–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞ ‚úÖ
   - –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å: "Failed to update SL on MT5"
   
5. **20:00:18**: –í—Å–µ 3 –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç—ã
   - –í–µ—Ä–æ—è—Ç–Ω–æ, –≤—Å–µ —Ç—Ä–∏ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥–æ—Å—Ç–∏–≥–ª–∏ SL ($5026.17)

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

#### –ü—Ä–∏—á–∏–Ω–∞ 1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥–∞

**–°—Ç–∞—Ä—ã–π –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 784-788):**
```python
# If Position 1 not found in group (already closed), activate trailing
if not pos1_found and not group_info['tp1_hit']:
    group_info['tp1_hit'] = True  # ‚ùå –ê–ö–¢–ò–í–ò–†–£–ï–¢ –í–°–ï–ì–î–ê
    tp1_just_hit = True
    print(f"üéØ Group {group_id[:8]} Position 1 closed! Activating trailing for Pos 2 & 3")
```

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- –≠—Ç–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ "–ø–æ–∑–∏—Ü–∏—è 1 –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
- –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ—á–µ–º—É –æ–Ω–∞ –∑–∞–∫—Ä—ã–ª–∞—Å—å (TP1 –∏–ª–∏ SL?)
- –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ç—Ä–µ–π–ª–∏–Ω–≥ –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø–æ SL!

#### –ü—Ä–∏—á–∏–Ω–∞ 2: –ü–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø–æ SL

–ê–Ω–∞–ª–∏–∑–∏—Ä—É—è —Ü–∏—Ñ—Ä—ã:
- Entry: $5096.17
- Current price (20:00:18): $5095.21 ‚¨ÖÔ∏è –¶–µ–Ω–∞ –£–ü–ê–õ–ê
- SL: $5026.17
- TP1: $5156.17

**–í—ã–≤–æ–¥**: –¶–µ–Ω–∞ –¥–≤–∏–≥–∞–ª–∞—Å—å –≤–Ω–∏–∑, –¥–æ—Å—Ç–∏–≥–ª–∞ SL ($5026.17), –≤—Å–µ 3 –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–ª–∏—Å—å –ø–æ Stop Loss.

#### –ü—Ä–∏—á–∏–Ω–∞ 3: –¢—Ä–µ–π–ª–∏–Ω–≥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª—Å—è –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ

- –ü–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã–ª–∞—Å—å —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
- –ë–æ—Ç —Ä–µ—à–∏–ª: "Position 1 closed = TP1 hit" ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
- –ü–æ–ø—ã—Ç–∞–ª—Å—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–π–ª–∏–Ω–≥ –¥–ª—è –ø–æ–∑–∏—Ü–∏–π 2 –∏ 3
- –ù–æ –º–æ–∏ –∑–∞—â–∏—Ç—ã (–≤–æ–∑—Ä–∞—Å—Ç –≥—Ä—É–ø–ø—ã, distance validation) –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ SL ‚úÖ

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 784-831):

```python
# If Position 1 not found in group (already closed), check WHY it closed
if not pos1_found and not group_info['tp1_hit']:
    # CRITICAL: Don't activate trailing if position 1 closed by SL or error!
    
    pos1_closed_by_tp1 = False
    
    # Check in-memory tracker
    for ticket, pos_data in list(self.positions_tracker.items()):
        if (pos_data.get('position_group_id') == group_id and 
            pos_data.get('position_num') == 1 and
            pos_data.get('status') in ['TP1', 'TP1_PROCESSING']):
            pos1_closed_by_tp1 = True
            break
    
    # Check database
    if not pos1_closed_by_tp1 and self.use_database:
        # Verify close price was near TP1
        trade = find_position_1_in_db(group_id)
        if trade.close_price >= tp1_price * 0.999:  # Within 0.1%
            pos1_closed_by_tp1 = True
    
    # Only activate if TP1 genuinely hit
    if pos1_closed_by_tp1:
        activate_trailing()
        print("Position 1 closed by TP1! Activating trailing")
    else:
        # DO NOT activate trailing!
        print("‚ö†Ô∏è Position 1 closed but NOT by TP1 - trailing NOT activated")
```

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏—á–∏–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è**:
   - –ò—â–µ—Ç –ø–æ–∑–∏—Ü–∏—é 1 –≤ tracker —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'TP1' –∏–ª–∏ 'TP1_PROCESSING'
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤ –ë–î: –±—ã–ª–∞ –ª–∏ —Ü–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–æ–ª–æ TP1
   - –î–ª—è BUY: close_price >= tp1 * 0.999 (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 0.1%)
   - –î–ª—è SELL: close_price <= tp1 * 1.001

2. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ TP1**:
   - –¢—Ä–µ–π–ª–∏–Ω–≥ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø–æ TP1
   - –ï—Å–ª–∏ –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø–æ SL/–≤—Ä—É—á–Ω—É—é - —Ç—Ä–µ–π–ª–∏–Ω–≥ –ù–ï –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è

3. **–ü–æ–Ω—è—Ç–Ω—ã–µ –ª–æ–≥–∏**:
   - "Position 1 closed by TP1! Activating trailing" ‚úÖ
   - "Position 1 closed but NOT by TP1 - trailing NOT activated" ‚ö†Ô∏è

## üìä CSV: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è group_id –∏ position_num

### –ü—Ä–æ–±–ª–µ–º–∞:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª: "–ø–æ—á–µ–º—É –≤—Å–µ —Ç—Ä–∏ –ø–æ–∑–∏—Ü–∏–π –±–µ–∑ pos# and group"

### –ü—Ä–∏—á–∏–Ω–∞:
CSV —Ñ–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∞–ª –ø–æ–ª–µ–π `position_group_id` –∏ `position_num`

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

**–ó–∞–≥–æ–ª–æ–≤–æ–∫ CSV (_initialize_trades_log):**
```python
writer.writerow([
    'Ticket', 'Open_Time', 'Close_Time', 'Type', 'Volume',
    'Entry_Price', 'SL', 'TP', 'Close_Price', 'Profit',
    'Pips', 'Market_Regime', 'Duration_Hours', 'Status', 'Comment',
    'Position_Group_ID', 'Position_Num'  # ‚¨ÖÔ∏è –î–û–ë–ê–í–õ–ï–ù–û
])
```

**–ó–∞–ø–∏—Å—å –≤ CSV (_write_trade_to_csv):**
```python
writer.writerow([
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
    trade_data.get('position_group_id', ''),  # ‚¨ÖÔ∏è –î–û–ë–ê–í–õ–ï–ù–û
    trade_data.get('position_num', 0)         # ‚¨ÖÔ∏è –î–û–ë–ê–í–õ–ï–ù–û
])
```

–¢–µ–ø–µ—Ä—å CSV –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
```csv
Ticket,Open_Time,Close_Time,...,Position_Group_ID,Position_Num
239807,2026-01-26 20:00:06,...,e0d3e8e3,1
239808,2026-01-26 20:00:07,...,e0d3e8e3,2
239809,2026-01-26 20:00:07,...,e0d3e8e3,3
```

## üéØ –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: TP1 –¥–æ—Å—Ç–∏–≥–Ω—É—Ç ‚úÖ
```
[20:00:00] –û—Ç–∫—Ä—ã—Ç—ã 3 –ø–æ–∑–∏—Ü–∏–∏: Entry=$5096, SL=$5026, TP1=$5156
[20:05:00] –¶–µ–Ω–∞ –¥–æ—Å—Ç–∏–≥–ª–∞ $5156
[20:05:00] –ü–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ TP1
[20:05:01] ‚úÖ –ü–æ–∑–∏—Ü–∏—è 1 –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞: –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ TP1 (close=$5156)
[20:05:01] üéØ –¢—Ä–µ–π–ª–∏–Ω–≥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø–æ–∑–∏—Ü–∏–π 2 –∏ 3
[20:05:05] SL –ø–æ–∑–∏—Ü–∏–π 2 –∏ 3 –æ–±–Ω–æ–≤–ª–µ–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ
[20:10:00] –ü–æ–∑–∏—Ü–∏—è 2 –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ TP2 ($5186) ‚úÖ
[20:15:00] –ü–æ–∑–∏—Ü–∏—è 3 –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ TP3 ($5216) ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: SL –¥–æ—Å—Ç–∏–≥–Ω—É—Ç (–∫–∞–∫ –≤ –≤–∞—à–∏—Ö –ª–æ–≥–∞—Ö) ‚úÖ
```
[20:00:00] –û—Ç–∫—Ä—ã—Ç—ã 3 –ø–æ–∑–∏—Ü–∏–∏: Entry=$5096, SL=$5026, TP1=$5156
[20:00:18] –¶–µ–Ω–∞ —É–ø–∞–ª–∞ –¥–æ $5026
[20:00:18] –ü–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ SL
[20:00:18] ‚ö†Ô∏è  –ü–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã—Ç–∞ –ù–ï –ø–æ TP1 (close=$5026 << tp1=$5156)
[20:00:18] –¢—Ä–µ–π–ª–∏–Ω–≥ –ù–ï –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
[20:00:18] –ü–æ–∑–∏—Ü–∏–∏ 2 –∏ 3 —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –∏—Å—Ö–æ–¥–Ω—ã–π SL
[20:00:18] –ü–æ–∑–∏—Ü–∏–∏ 2 –∏ 3 –∑–∞–∫—Ä—ã—Ç—ã –ø–æ SL ($5026)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ ‚úÖ
```
[20:00:00] –û—Ç–∫—Ä—ã—Ç—ã 3 –ø–æ–∑–∏—Ü–∏–∏
[20:05:00] –ü–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ TP1
[20:05:01] ‚úÖ –¢—Ä–µ–π–ª–∏–Ω–≥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
[20:05:05] –ü–æ–∑–∏—Ü–∏—è 2 –∑–∞–∫—Ä—ã—Ç–∞ –≤—Ä—É—á–Ω—É—é —Ç—Ä–µ–π–¥–µ—Ä–æ–º
[20:05:05] (–ü–æ–∑–∏—Ü–∏—è 3 –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç—Ä–µ–π–ª–∏–Ω–≥–æ–º)
[20:10:00] –ü–æ–∑–∏—Ü–∏—è 3 –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ —Ç—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø—É ‚úÖ
```

## üìù –†–µ–∑—é–º–µ

### –ß—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫:

1. ‚ùå –¢—Ä–µ–π–ª–∏–Ω–≥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª—Å—è, –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã–≤–∞–ª–∞—Å—å –ü–û –õ–Æ–ë–û–ô –ø—Ä–∏—á–∏–Ω–µ
2. ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å, –±—ã–ª –ª–∏ —ç—Ç–æ TP1 –∏–ª–∏ SL
3. ‚ùå CSV –Ω–µ —Å–æ–¥–µ—Ä–∂–∞–ª group_id –∏ position_num

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏—á–∏–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ 1
2. ‚úÖ –¢—Ä–µ–π–ª–∏–Ω–≥ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ TP1
3. ‚úÖ CSV —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç Position_Group_ID –∏ Position_Num
4. ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ –ª–æ–≥–∏ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —Ä–µ—à–µ–Ω–∏–π

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞—â–∏—Ç—ã (—É–∂–µ –±—ã–ª–∏):

1. ‚úÖ –ì—Ä—É–ø–ø–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å >= 60 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç—Ä–µ–π–ª–∏–Ω–≥–∞
2. ‚úÖ –ü–æ–∑–∏—Ü–∏—è–º –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å >= 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ SL
3. ‚úÖ SL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å >= 0.3% –æ—Ç entry –∏ >= 0.2% –æ—Ç current price
4. ‚úÖ –ú–µ–∂–¥—É –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏ SL –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ >= 10 —Å–µ–∫—É–Ω–¥

## üß™ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π 1: TP1 Hit
1. –û—Ç–∫—Ä—ã—Ç—å 3 –ø–æ–∑–∏—Ü–∏–∏ –≤ BUY
2. –î–æ–∂–¥–∞—Ç—å—Å—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è TP1
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: "Position 1 confirmed closed by TP1"
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–∞—Ü–∏—é —Ç—Ä–µ–π–ª–∏–Ω–≥–∞
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSV: –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

### –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π 2: SL Hit (–∫–∞–∫ –≤ –≤–∞—à–∏—Ö –ª–æ–≥–∞—Ö)
1. –û—Ç–∫—Ä—ã—Ç—å 3 –ø–æ–∑–∏—Ü–∏–∏ –≤ BUY
2. –¶–µ–Ω–∞ –∏–¥—ë—Ç –≤–Ω–∏–∑, –¥–æ—Å—Ç–∏–≥–∞–µ—Ç SL
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: "Position 1 closed but NOT by TP1"
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Ç—Ä–µ–π–ª–∏–Ω–≥ –ù–ï –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø–æ–∑–∏—Ü–∏–∏ 2 –∏ 3 –∑–∞–∫—Ä—ã–ª–∏—Å—å –ø–æ SL —Å –∏—Å—Ö–æ–¥–Ω—ã–º SL

### –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π 3: CSV –ü—Ä–æ–≤–µ—Ä–∫–∞
1. –û—Ç–∫—Ä—ã—Ç—å –ª—é–±—É—é 3-position –≥—Ä—É–ø–ø—É
2. –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–∫—Ä—ã—Ç–∏—è
3. –û—Ç–∫—Ä—ã—Ç—å CSV —Ñ–∞–π–ª
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤ Position_Group_ID –∏ Position_Num
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –≤—Å–µ 3 –ø–æ–∑–∏—Ü–∏–∏ –∏–º–µ—é—Ç –æ–¥–∏–Ω group_id
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: position_num = 1, 2, 3

---

**–í—ã–≤–æ–¥**: –ù–æ–≤—ã–π –∫–æ–¥ —Ä–µ—à–∞–µ—Ç –ò–ú–ï–ù–ù–û —Ç—É –ø—Ä–æ–±–ª–µ–º—É, –∫–æ—Ç–æ—Ä—É—é –≤—ã –ø–æ–∫–∞–∑–∞–ª–∏ –≤ –ª–æ–≥–∞—Ö. –¢–µ–ø–µ—Ä—å —Ç—Ä–µ–π–ª–∏–Ω–≥ –Ω–µ –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è, –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è 1 –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø–æ SL.
