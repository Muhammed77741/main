# üîß –†–µ–∑—é–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–ª—è Paper Trading Bot

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. ‚ùå ‚Üí ‚úÖ TP (Take Profit) –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** TP –ø—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (TP3 ‚Üí TP2 ‚Üí TP1), –∏–∑-–∑–∞ —á–µ–≥–æ –ø—Ä–∏ —Ä–µ–∑–∫–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ —Ü–µ–Ω—ã —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Ç–æ–ª—å–∫–æ TP3 (20% –ø–æ–∑–∏—Ü–∏–∏), –∞ TP1 –∏ TP2 –ø—Ä–æ–ø—É—Å–∫–∞–ª–∏—Å—å.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –¢–µ–ø–µ—Ä—å TP –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ: TP1 ‚Üí TP2 ‚Üí TP3
- ‚úÖ –í—Å–µ —É—Ä–æ–≤–Ω–∏ TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –¥–∞–∂–µ –ø—Ä–∏ —Ä–µ–∑–∫–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ —Ü–µ–Ω—ã
- ‚úÖ –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é (100%), –∞ –Ω–µ —á–∞—Å—Ç–∏—á–Ω–æ (20%)

**–ü—Ä–∏–º–µ—Ä:**
```
–ë—ã–ª–æ:
–¶–µ–Ω–∞ —Å–∫–∞–∫–Ω—É–ª–∞ —Å 2650 –¥–æ 2725
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ó–∞–∫—Ä—ã–ª–∏ —Ç–æ–ª—å–∫–æ 20% (TP3) ‚ùå

–°—Ç–∞–ª–æ:
–¶–µ–Ω–∞ —Å–∫–∞–∫–Ω—É–ª–∞ —Å 2650 –¥–æ 2725
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ó–∞–∫—Ä—ã–ª–∏ 100% (TP1+TP2+TP3) ‚úÖ
```

---

### 2. ‚è∞ ‚Üí ‚úÖ –í—Ä–µ–º—è –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ timezone –ø—Ä–∏–≤–æ–¥–∏–ª–∞ –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ –≤ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ `_convert_to_local_time()`
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ pandas Timestamp –∏ datetime
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å timezone-aware –∏ naive timestamps
- ‚úÖ –í—Ä–µ–º—è –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö —Ç–µ–ø–µ—Ä—å —Ç–æ—á–Ω–æ–µ (UTC+5)

---

### 3. ‚è±Ô∏è ‚Üí ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –ø–æ–∑–∏—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —É—Ö–æ–¥–∏–ª–∏ –≤ —Ç–∞–π–º–∞—É—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å pandas Timestamp –∏ datetime).

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤ timestamp –ø–µ—Ä–µ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤ —Å–¥–µ–ª–∫–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω debug –≤—ã–≤–æ–¥ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è:
  ```
  ‚è±Ô∏è Position 1: 5.5h / 60h (Entry: 2025-12-30 10:00:00, Now: 2025-12-30 15:30:00)
  ```
- ‚úÖ –ü–æ–∑–∏—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ç–∞–π–º–∞—É—Ç–∞

---

### 4. üõ°Ô∏è –ù–û–í–û–ï: Breakeven –ø–æ—Å–ª–µ TP1

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞ –≤ –±–µ–∑—É–±—ã—Ç–æ–∫ –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è TP1.

**–ó–∞—á–µ–º:** –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –ø—Ä–∏–±—ã–ª–∏ –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ —Ü–µ–Ω—ã.

**–ü—Ä–∏–º–µ—Ä:**
```
–ë–µ–∑ breakeven:
10:00 - LONG @ 2650, SL @ 2541
10:15 - TP1 @ 2680 (+30–ø) ‚Üí –∑–∞–∫—Ä—ã–ª–∏ 50%
10:30 - –û—Ç–∫–∞—Ç –∫ 2545 ‚Üí SL @ 2541 —Å—Ä–∞–±–æ—Ç–∞–ª
–†–µ–∑—É–ª—å—Ç–∞—Ç: +15–ø - 54.5–ø = -39.5–ø (–£–ë–´–¢–û–ö!) ‚ùå

–° breakeven:
10:00 - LONG @ 2650, SL @ 2541
10:15 - TP1 @ 2680 ‚Üí –∑–∞–∫—Ä—ã–ª–∏ 50%
        ‚Üí SL –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏ –Ω–∞ 2655 (breakeven+5) ‚úÖ
10:30 - –û—Ç–∫–∞—Ç –∫ 2545 ‚Üí SL –ù–ï —Å—Ä–∞–±–æ—Ç–∞–ª
10:45 - –†–æ—Å—Ç –¥–æ 2700 ‚Üí TP2 —Å—Ä–∞–±–æ—Ç–∞–ª!
–†–µ–∑—É–ª—å—Ç–∞—Ç: +15–ø + 15–ø = +30–ø (–ü–†–ò–ë–´–õ–¨!) ‚úÖ
```

---

### 5. üí∞ –ù–û–í–û–ï: –£—á–µ—Ç —Å–ø—Ä–µ–¥–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** –í—Ö–æ–¥ –≤ –ø–æ–∑–∏—Ü–∏—é –ø–æ —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω–µ (ASK –¥–ª—è LONG, BID –¥–ª—è SHORT), –∞ –Ω–µ –ø–æ close price.

**–ó–∞—á–µ–º:** –ë–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

**–ü—Ä–∏–º–µ—Ä:**
```
Close price: 2650
Bid: 2649.5
Ask: 2651.5

–ë—ã–ª–æ:
LONG –≤—Ö–æ–¥ @ 2650 ‚ùå (–Ω–µ—Ä–µ–∞–ª—å–Ω–æ)

–°—Ç–∞–ª–æ:
LONG –≤—Ö–æ–¥ @ 2651.5 (ASK) ‚úÖ (—Ä–µ–∞–ª—å–Ω–æ)
SHORT –≤—Ö–æ–¥ @ 2649.5 (BID) ‚úÖ (—Ä–µ–∞–ª—å–Ω–æ)
```

---

### 6. üì± –£–ª—É—á—à–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã—Ö TP –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
- ‚úÖ –ù–æ–≤—ã–µ —Ç–∏–ø—ã –≤—ã—Ö–æ–¥–∞: TRAILING_SL, ALL_TPS_HIT, FULLY_CLOSED
- ‚úÖ –ë–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä:**
```
–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:
"‚úÖ –ü–†–ò–ë–´–õ–¨ - –ó–ê–ö–†–´–¢–ò–ï –ü–û–ó–ò–¶–ò–ò
Exit: ALL_TPS_HIT
üéØ TPs: TP1 ‚úÖ | TP2 ‚úÖ | TP3 ‚úÖ
PnL: +1.2% (+32 points)
–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 12.5 —á–∞—Å–æ–≤"
```

---

## üìä –í–õ–ò–Ø–ù–ò–ï –ù–ê –†–ï–ó–£–õ–¨–¢–ê–¢–´

### H1 –°—Ç—Ä–∞—Ç–µ–≥–∏—è (–≤–∞—à —Å–ª—É—á–∞–π)

| –ß—Ç–æ | –î–æ | –ü–æ—Å–ª–µ |
|-----|----|----|
| –†–µ–∑—É–ª—å—Ç–∞—Ç—ã | –ó–∞–≤—ã—à–µ–Ω–Ω—ã–µ | –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ |
| PnL | +387% | +320-350% |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ | - | -10-20% |

**–í—ã–≤–æ–¥—ã:**
- ‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–±—ã–ª—å–Ω–æ–π
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–µ–µ
- ‚úÖ Breakeven –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —É–±—ã—Ç–∫–æ–≤
- ‚úÖ –í—Å–µ TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üöÄ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:

```bash
cd /workspace/smc_trading_strategy
python3 paper_trading_improved.py
```

### 2. –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

‚úÖ **TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```
üéØ TP1 HIT @ 2680.00 (50%)
üõ°Ô∏è Stop moved to breakeven+5: 2655.00
üîÑ Trailing stop activated: 18–ø
üéØ TP2 HIT @ 2700.00 (30%)
üéØ TP3 HIT @ 2720.00 (20%)
```

‚úÖ **–í—Ä–µ–º—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ:**
```
‚è±Ô∏è Position 1: 5.5h / 60h (Entry: 2025-12-30 10:00:00, Now: 2025-12-30 15:30:00)
```

‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ:**
```
‚úÖ –ü–†–ò–ë–´–õ–¨ - –ó–ê–ö–†–´–¢–ò–ï –ü–û–ó–ò–¶–ò–ò
üéØ TPs: TP1 ‚úÖ | TP2 ‚úÖ | TP3 ‚úÖ
```

---

## üìù –ß–¢–û –ò–ó–ú–ï–ù–ï–ù–û

### –§–∞–π–ª—ã:

1. **paper_trading_improved.py** - –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –±–æ—Ç–∞
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—è–¥–æ–∫ TP (TP1‚ÜíTP2‚ÜíTP3)
   - –î–æ–±–∞–≤–ª–µ–Ω breakeven –ø–æ—Å–ª–µ TP1
   - –î–æ–±–∞–≤–ª–µ–Ω —É—á–µ—Ç —Å–ø—Ä–µ–¥–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç timeout
   - –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π

2. **telegram_notifier.py** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ timezone
   - –£–ª—É—á—à–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ TP

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```
paper_trading_improved.py | +138 -50 —Å—Ç—Ä–æ–∫
telegram_notifier.py      | +73 -23 —Å—Ç—Ä–æ–∫
–í—Å–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:          | +211 -73 —Å—Ç—Ä–æ–∫
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

1. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–µ–µ** - –±—É–¥—É—Ç –Ω–µ–º–Ω–æ–≥–æ —Ö—É–∂–µ, –Ω–æ —á–µ—Å—Ç–Ω–µ–µ
2. **H1 —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–±—ã–ª—å–Ω–æ–π** - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
3. **Breakeven –∑–∞—â–∏—â–∞–µ—Ç –ø—Ä–∏–±—ã–ª—å** - –º–µ–Ω—å—à–µ —É–±—ã—Ç–∫–æ–≤
4. **–í—Å–µ TP —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç** - –±–æ–ª—å—à–µ –ø—Ä–∏–±—ã–ª–∏ –ø—Ä–∏ —Ä–µ–∑–∫–∏—Ö –¥–≤–∏–∂–µ–Ω–∏—è—Ö
5. **–í—Ä–µ–º—è —Ç–æ—á–Ω–æ–µ** - –ª–µ–≥—á–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–¥–µ–ª–∫–∏

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –µ—â–µ —É–ª—É—á—à–∏—Ç—å:

1. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∏—Å—Å–∏–∏** (~-5% –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º)
2. **–î–æ–±–∞–≤–∏—Ç—å swap** (–¥–ª—è –ø–æ–∑–∏—Ü–∏–π >24—á)
3. **–î–æ–±–∞–≤–∏—Ç—å –¥–Ω–µ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã** (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–µ—Ä–∏–∏ —É–±—ã—Ç–∫–æ–≤)
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª** (–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)

–ù–æ —Ç–µ–∫—É—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–∂–µ —Ä–µ—à–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã! ‚úÖ

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ debug –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
3. –°—Ä–∞–≤–Ω–∏—Ç–µ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≤—ã—à–µ

---

**–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã! –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ! üöÄ**

–£–¥–∞—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏! üìà
