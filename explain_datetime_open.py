"""
ОТВЕТ: Date/Time в Signal Analysis - это время открытия или закрытия?

Подробное объяснение того, что показывает поле Date/Time (Open)
"""

print("="*80)
print("ВОПРОС: Date/Time в Signal Analysis - открытие или закрытие бара?")
print("="*80)

print("""
✅ ОТВЕТ: Время ОТКРЫТИЯ бара
==============================

Поле "Date/Time (Open)" в Signal Analysis показывает время ОТКРЫТИЯ бара.


ПОЧЕМУ ТАК?
===========

1. СТАНДАРТ OHLC данных
   ------------------------
   В трейдинге свечные (candlestick) данные имеют формат OHLC:
   
   timestamp = время ОТКРЫТИЯ бара
   open      = цена открытия
   high      = максимальная цена за период
   low       = минимальная цена за период
   close     = цена закрытия
   
   Это международный стандарт для всех бирж и платформ.


2. Binance API
   ------------
   Возвращает данные в формате:
   [
     timestamp,  ← время ОТКРЫТИЯ бара (в миллисекундах)
     open,
     high,
     low,
     close,
     volume,
     ...
   ]


3. MT5 API
   --------
   Структура MqlRates:
   - time  ← время ОТКРЫТИЯ бара
   - open  ← цена открытия
   - high  ← максимум
   - low   ← минимум
   - close ← цена закрытия


4. Pandas DataFrame
   -----------------
   После загрузки данных:
   
   df['timestamp'] = pd.to_datetime(df['timestamp'], unit='ms')
   df.set_index('timestamp', inplace=True)
   
   Индекс DataFrame = timestamp = время ОТКРЫТИЯ бара


ПРИМЕРЫ:
========

Пример 1: Бар H1 (1 час)
-------------------------
Date/Time (Open): 2024-01-15 14:00  ← Показывается в таблице
Период бара:      14:00 - 15:00
Закрытие:         2024-01-15 15:00

Сигнал генерируется на ЗАКРЫТИИ бара (в 15:00)
Но timestamp показывает ОТКРЫТИЕ (14:00)


Пример 2: Бар M15 (15 минут)
-----------------------------
Date/Time (Open): 2024-01-15 14:00  ← Показывается в таблице
Период бара:      14:00 - 14:15
Закрытие:         2024-01-15 14:15

Сигнал генерируется на ЗАКРЫТИИ бара (в 14:15)
Но timestamp показывает ОТКРЫТИЕ (14:00)


Пример 3: Бар M5 (5 минут)
---------------------------
Date/Time (Open): 2024-01-15 14:00  ← Показывается в таблице
Период бара:      14:00 - 14:05
Закрытие:         2024-01-15 14:05

Сигнал генерируется на ЗАКРЫТИИ бара (в 14:05)
Но timestamp показывает ОТКРЫТИЕ (14:00)


ВАЖНОЕ ПОНИМАНИЕ:
==================

┌─────────────────────────────────────────────────────────────┐
│  Когда вы видите сигнал с Date/Time (Open) "14:00":        │
│                                                             │
│  ✓ Это бар, который ОТКРЫЛСЯ в 14:00                       │
│  ✓ Сигнал сгенерирован на ЗАКРЫТИИ этого бара              │
│  ✓ Время закрытия зависит от таймфрейма:                   │
│    - H1:  бар закрылся в 15:00                             │
│    - M30: бар закрылся в 14:30                             │
│    - M15: бар закрылся в 14:15                             │
│    - M5:  бар закрылся в 14:05                             │
└─────────────────────────────────────────────────────────────┘


КАК РАБОТАЕТ LIVE BOT:
======================

Live Bot проверяет сигналы ПОСЛЕ закрытия бара:

Пример на H1:
-------------
15:00 - Бар 14:00-15:00 только что ЗАКРЫЛСЯ
      - Live Bot запускает проверку
      - Находит сигнал на баре с timestamp 14:00
      - Это сигнал на только что закрытом баре ✓
      - Открывает позицию


Важно:
------
Live Bot использует df.index[-2] (последний ЗАКРЫТЫЙ бар)
Timestamp этого бара = 14:00 (время открытия)
Но бар закрылся только что в 15:00!


ВЫЧИСЛЕНИЕ ВРЕМЕНИ ЗАКРЫТИЯ:
=============================

Если нужно узнать время закрытия бара:

Bar Close Time = Bar Open Time + Timeframe

Примеры:
--------
H1:  14:00 + 1 час    = 15:00
M30: 14:00 + 30 минут = 14:30
M15: 14:00 + 15 минут = 14:15
M5:  14:00 + 5 минут  = 14:05


ПОЧЕМУ ПОКАЗЫВАЕМ ВРЕМЯ ОТКРЫТИЯ?
==================================

1. Стандарт индустрии
   Все платформы (TradingView, MT5, Binance) используют время открытия

2. Уникальная идентификация
   Время открытия однозначно идентифицирует бар

3. Соответствие с данными
   Timestamp из API = время открытия

4. Согласованность
   Backtest и Live Bot используют одинаковую логику


ОБНОВЛЕНИЕ UI:
==============

Теперь колонка называется "Date/Time (Open)" вместо "Date/Time"

Это делает очевидным, что показывается время ОТКРЫТИЯ бара!


ИТОГО:
======

✅ Date/Time (Open) = время ОТКРЫТИЯ бара
✅ Сигнал генерируется на ЗАКРЫТИИ бара
✅ Это стандартное поведение для всех торговых платформ
✅ Live Bot работает с теми же данными
✅ Теперь название колонки делает это понятным


ДОПОЛНИТЕЛЬНАЯ ИНФОРМАЦИЯ:
==========================

Если нужно вычислить время закрытия:
  Close Time = Open Time + Timeframe

Если нужно найти конкретный бар:
  Используйте время открытия для поиска

Если сравниваете с графиком:
  График также показывает время открытия для каждой свечи
""")

print("="*80)
