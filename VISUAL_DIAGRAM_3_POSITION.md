# 3-Position Multi-TP Feature - Visual Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SIGNAL GENERATED (e.g., BUY)                        â”‚
â”‚                     Entry: $50,000                                       â”‚
â”‚                     SL: $49,600 (-0.8%)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  3 POSITIONS CREATED  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼               â–¼               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ POSITION 1 â”‚  â”‚ POSITION 2 â”‚  â”‚ POSITION 3 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            Target: TP1     Target: TP2     Target: TP3
            $50,750 (+1.5%) $51,375 (+2.75%) $52,250 (+4.5%)
            Trailing: âŒ     Trailing: âœ…     Trailing: âœ…
            
                    â”‚               â”‚               â”‚
                    â”‚               â”‚               â”‚
                    â–¼               â–¼               â–¼
                    
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         PRICE ACTION TIMELINE                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            
Bar 1-10:   Price climbs from $50,000 â†’ $50,700
            All positions OPEN ğŸŸ¢

Bar 11:     Price touches $50,750 (TP1 HIT!)
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Position 1: CLOSES at TP1 âœ…        â”‚
            â”‚   Profit: +1.5%                     â”‚
            â”‚   Close Reason: TP1                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            
            Position 2: Still OPEN ğŸŸ¢
              â†’ Trailing ACTIVATED
              â†’ Trailing Stop: $50,375
            
            Position 3: Still OPEN ğŸŸ¢
              â†’ Trailing ACTIVATED
              â†’ Trailing Stop: $50,375

Bar 12-15:  Price climbs to $50,950
            Position 2: Still OPEN ğŸŸ¢
              â†’ Max Price: $50,950
              â†’ Trailing Stop Updates: $50,475
            
            Position 3: Still OPEN ğŸŸ¢
              â†’ Max Price: $50,950
              â†’ Trailing Stop Updates: $50,475

Bar 16:     Price reverses to $50,500
            Position 2: Still OPEN ğŸŸ¢
              â†’ Trailing Stop: $50,475 (not hit)
            
            Position 3: Still OPEN ğŸŸ¢
              â†’ Trailing Stop: $50,475 (not hit)

Bar 17:     Price climbs to $51,400 (TP2 HIT!)
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Position 2: CLOSES at TP2 âœ…        â”‚
            â”‚   Profit: +2.75%                    â”‚
            â”‚   Close Reason: TP2                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            
            Position 3: Still OPEN ğŸŸ¢
              â†’ Max Price: $51,400
              â†’ Trailing Stop Updates: $50,700

Bar 18-20:  Price consolidates around $51,200
            Position 3: Still OPEN ğŸŸ¢
              â†’ Trailing Stop: $50,700

Bar 21:     Price drops to $50,650
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Position 3: CLOSES via Trailing âœ…   â”‚
            â”‚   Profit: +1.40%                    â”‚
            â”‚   Close Reason: Trailing Stop       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FINAL RESULTS                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Position â”‚ Target  â”‚ Outcome   â”‚ Profit %     â”‚ Close Reason          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    1     â”‚  TP1    â”‚  Win âœ…   â”‚   +1.50%     â”‚ TP1                   â”‚
â”‚    2     â”‚  TP2    â”‚  Win âœ…   â”‚   +2.75%     â”‚ TP2                   â”‚
â”‚    3     â”‚  TP3    â”‚  Win âœ…   â”‚   +1.40%     â”‚ Trailing Stop         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Average Profit: +1.88%
Total Bars: 21
Group ID: abc123-def456-...
```

## Key Observations

### Position Independence
Each position is completely independent:
- Position 1 closed at bar 11 (TP1)
- Position 2 closed at bar 17 (TP2)
- Position 3 closed at bar 21 (Trailing)

### Trailing Stop Behavior
- **Activation**: Only after TP1 touched (bar 11)
- **Updates**: Moves up as price increases
- **Protection**: Locks in profits above entry
- **Formula**: `stop = max_price - (max_price - entry) Ã— 50%`

### Realistic Simulation
This matches real trading where:
- Some positions close early (conservative)
- Some positions maximize gains (aggressive)
- Trailing stops protect profits after TP1

## Comparison: Single vs 3-Position

### Single-Position Mode (Old)
```
Signal â†’ 1 Row â†’ 1 Outcome â†’ Average of partial closes
Result: +2.15% (weighted average)
```

### 3-Position Mode (New)
```
Signal â†’ 3 Rows â†’ 3 Independent Outcomes
Position 1: +1.50%
Position 2: +2.75%
Position 3: +1.40%
```

**Benefits:**
- âœ… See exact profit per position
- âœ… Compare strategies (TP1 only vs trailing)
- âœ… Understand risk/reward tradeoffs
- âœ… More realistic portfolio simulation

## SL Hit Scenario

What if price dropped immediately?

```
Bar 1:      Price drops to $49,500 (SL HIT!)
            
            All positions close at SL:
            
            Position 1: Loss âŒ (-1.0%)
            Position 2: Loss âŒ (-1.0%)
            Position 3: Loss âŒ (-1.0%)
            
            Close Reason: SL (all positions)
```

## CSV Export Structure

```csv
timestamp,signal,position_group_id,position_num,outcome,profit_pct,tp_levels_hit,bars_held
2025-01-15 10:00,1,abc-123,1,Win âœ…,1.50,TP1,11
2025-01-15 10:00,1,abc-123,2,Win âœ…,2.75,TP2,17
2025-01-15 10:00,1,abc-123,3,Win âœ…,1.40,Trailing,21
```

**Excel Analysis:**
- Filter by `position_group_id` to see all 3 positions for one signal
- Pivot table: Average profit by position_num
- Chart: Position performance over time

## Use Cases

### 1. Conservative Trader
Focus on Position 1 results:
- Always closes at TP1
- No trailing risk
- Consistent, smaller profits

### 2. Balanced Trader
Focus on Position 2 results:
- Aims for TP2
- Trailing protects after TP1
- Good risk/reward balance

### 3. Aggressive Trader
Focus on Position 3 results:
- Aims for TP3
- Maximum potential profit
- Higher risk of trailing stop

### 4. Portfolio Analysis
Compare all 3 positions:
- Which strategy wins most often?
- Which has best average profit?
- Which has best risk-adjusted returns?

## Technical Notes

- Each signal generates exactly 3 positions
- Positions share same entry, SL, and TP levels
- Only difference: trailing behavior and target
- Group ID links positions to original signal
- Trailing activates ONLY after TP1 hit
- Position 1 NEVER uses trailing
- Positions close independently
