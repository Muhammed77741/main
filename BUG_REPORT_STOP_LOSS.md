# üêõ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ê–Ω–æ–º–∞–ª—å–Ω—ã–µ Stop Loss

## –ü—Ä–æ–±–ª–µ–º–∞

–í –º–∞–π—Å–∫–∏—Ö –±—ç–∫—Ç–µ—Å—Ç–∞—Ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å–¥–µ–ª–∫–∏ —Å **–∞–Ω–æ–º–∞–ª—å–Ω–æ –±–æ–ª—å—à–∏–º–∏ stop loss**:

| –î–∞—Ç–∞ | –¶–µ–Ω–∞ | Stop Loss | SL Distance | SL % |
|------|------|-----------|-------------|------|
| 05-01 | 2309.73 | **2488.53** | 178.80 | **7.74%** ‚ùå |
| 05-06 | 2322.69 | **2690.85** | 368.16 | **15.85%** ‚ùå‚ùå |
| 05-08 | 2305.56 | **2795.61** | 490.05 | **21.26%** ‚ùå‚ùå‚ùå |
| 05-13 | 2335.90 | **2791.45** | 455.55 | **19.50%** ‚ùå‚ùå‚ùå |
| 05-27 | 2355.84 | **3305.73** | 949.39 | **40.30%** ‚ùå‚ùå‚ùå‚ùå |

**–ù–æ—Ä–º–∞–ª—å–Ω—ã–π SL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 0.5-2%, –ù–ï 21-40%!**

## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–§–∞–π–ª:** `smc_trading_strategy/simplified_smc_strategy.py`
**–°—Ç—Ä–æ–∫–∞:** 269
**–ú–µ—Ç–æ–¥:** `_calculate_stop_loss()`

```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û! ‚ùå
else:  # Short
    recent_swings = df[df['swing_high']].iloc[max(0, idx-20):idx]
    if len(recent_swings) > 0:
        stop = recent_swings['high'].max()  # ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. –ë–µ—Ä—É—Ç—Å—è –≤—Å–µ swing highs –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ **20 —Å–≤–µ—á–µ–π**
2. –í—ã–±–∏—Ä–∞–µ—Ç—Å—è **–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô** (`.max()`)
3. –ï—Å–ª–∏ –≤ –æ–∫–Ω–µ –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–π swing high –Ω–∞ —É—Ä–æ–≤–Ω–µ 2795, –∞ —Ü–µ–Ω–∞ 2305 - SL = 2795!

### –ü—Ä–∏–º–µ—Ä:

```
–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: 2305.56
Swing highs –≤ –æ–∫–Ω–µ 20 —Å–≤–µ—á–µ–π:
  - 2024-04-20: 2795 (—Å—Ç–∞—Ä—ã–π –º–∞–∫—Å–∏–º—É–º)
  - 2024-05-06: 2332 (–Ω–µ–¥–∞–≤–Ω–∏–π)

–¢–µ–∫—É—â–∏–π –∫–æ–¥: stop = max(2795, 2332) = 2795  ‚ùå –û–®–ò–ë–ö–ê!
–ü—Ä–∞–≤–∏–ª—å–Ω–æ:    stop = 2332 (–±–ª–∏–∂–∞–π—à–∏–π)       ‚úÖ
```

## –í–ª–∏—è–Ω–∏–µ

–≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç –ø–æ—á–µ–º—É **–ú–ê–ô 2024** –ø–æ–∫–∞–∑–∞–ª **+181% –ø—Ä–∏–±—ã–ª–∏**:

- –°–¥–µ–ª–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–ª–∏—Å—å –ø–æ SL —Å **–ü–†–ò–ë–´–õ–¨–Æ +40%** –≤–º–µ—Å—Ç–æ —É–±—ã—Ç–∫–∞
- –ù–∞–ø—Ä–∏–º–µ—Ä: entry=2355, SL=3305, –Ω–æ —Ü–µ–Ω–∞ –ø–æ—à–ª–∞ –≤–≤–µ—Ä—Ö –∏ "–¥–æ—Å—Ç–∏–≥–ª–∞ SL" —Å –ø—Ä–∏–±—ã–ª—å—é!
- **–≠—Ç–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –∫–æ–¥–∞, –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è!**

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ü–û–°–õ–ï–î–ù–ò–ô swing high (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```python
else:  # Short
    recent_swings = df[df['swing_high']].iloc[max(0, idx-20):idx]
    if len(recent_swings) > 0:
        stop = recent_swings['high'].iloc[-1]  # –ü–æ—Å–ª–µ–¥–Ω–∏–π (–±–ª–∏–∂–∞–π—à–∏–π)
    else:
        stop = df['high'].iloc[max(0, idx-10):idx].max()

    return stop * 1.002
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å swing high –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–≤–µ—á–µ–π (–±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)

```python
else:  # Short
    # –ò—â–µ–º –±–ª–∏–∂–∞–π—à–∏–π swing high (–Ω–µ —Å—Ç–∞—Ä—à–µ 10 —Å–≤–µ—á–µ–π)
    recent_swings = df[df['swing_high']].iloc[max(0, idx-10):idx]
    if len(recent_swings) > 0:
        stop = recent_swings['high'].iloc[-1]
    else:
        stop = df['high'].iloc[max(0, idx-5):idx].max()

    return stop * 1.002
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π % –æ—Ç —Ü–µ–Ω—ã

```python
else:  # Short
    # SL –Ω–∞ 0.5-1% –≤—ã—à–µ —Ü–µ–Ω—ã
    entry = df['close'].iloc[idx]
    stop = entry * 1.005  # 0.5% —Ä–∏—Å–∫
    return stop
```

## –î–µ–π—Å—Ç–≤–∏—è

1. ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `_calculate_stop_loss()` –º–µ—Ç–æ–¥
3. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã –≤—Å–µ –±—ç–∫—Ç–µ—Å—Ç—ã —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º
4. ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ (–Ω–∞–π–¥–µ–Ω–∞ –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ)

–ö–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `.iloc[]` –Ω–∞ **–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–º** –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–µ:

```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û! ‚ùå
recent_swings = df[df['swing_low']].iloc[max(0, idx-20):idx]
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `idx` - –ø–æ–∑–∏—Ü–∏—è –≤ **–∏—Å—Ö–æ–¥–Ω–æ–º** –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–µ (10,000 —Å—Ç—Ä–æ–∫)
- `.iloc[]` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ **–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–º—É** df (—Ç–æ–ª—å–∫–æ ~100 swing points)
- –ü–æ–ª—É—á–∞–µ–º swing points –∏–∑ **–ë–£–î–£–©–ï–ì–û**!

**–ü—Ä–∏–º–µ—Ä:**
- –î–∞—Ç–∞: 2024-05-09 (–ø–æ–∑–∏—Ü–∏—è 223 –≤ –∏—Å—Ö–æ–¥–Ω–æ–º df)
- recent_swings.iloc[203:223] –±–µ—Ä–µ—Ç —Å—Ç—Ä–æ–∫–∏ 203-223 –∏–∑ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ df
- –ü–æ–ª—É—á–∞–µ–º swing lows –∏–∑ 2025-06-16! (–∏–∑ –±—É–¥—É—â–µ–≥–æ)

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```python
# –ü–†–ê–í–ò–õ–¨–ù–û! ‚úÖ
current_time = df.index[idx]
all_swing_lows = df[df['swing_low'] == True]
recent_swings = all_swing_lows[all_swing_lows.index < current_time].tail(20)
```

–§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ **–≤—Ä–µ–º–µ–Ω–∏**, –∞ –Ω–µ –ø–æ –ø–æ–∑–∏—Ü–∏–∏!

## –†–µ–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç

**–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- Total PnL: **+509.80%** (–∑–∞–≤—ã—à–µ–Ω–æ –≤ 10+ —Ä–∞–∑!)
- –ú–∞–π 2024: **+486.84%** (–∞—Ä—Ç–µ—Ñ–∞–∫—Ç)
- Profit Factor: 5.66

**–ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- Total PnL: **+42.60%** (—Ä–µ–∞–ª—å–Ω–æ!)
- –ú–∞–π 2024: **+4.67%** (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- Profit Factor: 1.43

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –º–µ—Å—è—Ü–∞–º (—Ä–µ–∞–ª—å–Ω—ã–µ):**
| –ú–µ—Å—è—Ü | –°–¥–µ–ª–æ–∫ | WR | PnL |
|-------|--------|-----|------|
| 2024-05 | 15 | 66.7% | +4.67% |
| 2025-03 | 26 | 80.8% | **+11.15%** ‚¨ÖÔ∏è –ª—É—á—à–∏–π |
| 2024-07 | 23 | 60.9% | **-3.21%** ‚¨ÖÔ∏è —Ö—É–¥—à–∏–π |

---

**–î–∞—Ç–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è:** 2026-01-03
**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2026-01-03
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**Commits:**
- c7c2fda: Document bug
- 23a4d1a: Fix bug (filter by time)
